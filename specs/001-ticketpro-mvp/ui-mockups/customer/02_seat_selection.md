# UI Mockup: 座席選択画面

**画面名**: 座席選択画面  
**ユーザー**: 購入者（ログイン済み）  
**URL**: `/events/{event_id}/seats/`  
**前提条件**: 会員ログイン済み

---

## 画面レイアウト

```
┌──────────────────────────────────────────────────────────────┐
│ TicketPro                    [マイページ] [user@example.com▼] │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│ 座席選択: 東京コンサート2026                                  │
├──────────────────────────────────────────────────────────────┤
│ 2026年1月20日(月) 19:00 ～ | 東京ホール                       │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ 選択中の座席: 2席                              合計: ¥10,000 │  │
│ │ S席: 1階席-A-5 (¥5,000)                    [×]            │  │
│ │ S席: 1階席-A-6 (¥5,000)                    [×]            │  │
│ │                                                        │  │
│ │                               [カートに追加]  [クリア]   │  │
│ └────────────────────────────────────────────────────────┘  │
│                                                              │
│ 座席表                                                       │
│ ┌────────────────────────────────────────────────────────┐  │
│ │                     ┌─────────────┐                     │  │
│ │                     │   ステージ   │                     │  │
│ │                     └─────────────┘                     │  │
│ │                                                        │  │
│ │ 1階席 (S席)                                             │  │
│ │                                                        │  │
│ │   A  [1][2][3][4][5][6][7][8][9][10]                   │  │
│ │   B  [1][2][3][4][5][6][7][8][9][10]                   │  │
│ │   C  [1][2][3][4][5][6][7][8][9][10]                   │  │
│ │   D  [1][2][3][4][5][6][7][8][9][10]                   │  │
│ │   E  [1][2][3][4][5][6][7][8][9][10]                   │  │
│ │                                                        │  │
│ │ 2階席 (A席)                                             │  │
│ │                                                        │  │
│ │   1  [1][2][3][4][5][6][7][8][9][10]                   │  │
│ │   2  [1][2][3][4][5][6][7][8][9][10]                   │  │
│ │                                                        │  │
│ │ 凡例:                                                   │  │
│ │ [緑] 空席  [青] 選択中  [黄] 他の人が選択中  [赤] 売約済  │  │
│ └────────────────────────────────────────────────────────┘  │
│                                                              │
│ 注意事項                                                     │
│ ・座席を選択後、10分以内にカートに追加してください           │
│ ・最大6席まで同時に選択できます                              │
│ ・他の購入者が同時に選択している座席は黄色で表示されます     │
│                                                              │
│ [イベント詳細に戻る]                                          │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## 画面要素

### 選択中の座席エリア

| 要素 | 説明 |
|-----|------|
| 座席情報 | 座席種別 + ブロック-列-番号 |
| 価格 | 各座席の価格 |
| [×]ボタン | 座席選択を解除 |
| 合計金額 | 選択中の座席の合計金額 |
| [カートに追加]ボタン | 選択座席をカートに追加 |
| [クリア]ボタン | すべての選択を解除 |

### 座席表（ビジュアル表示）

**座席の色分け**:
- **緑色**: 空席（クリック可能）
- **青色**: 自分が選択中（クリックで解除）
- **黄色**: 他の人が選択中（クリック不可）
- **赤色**: 売約済（クリック不可）

**座席ボタン**:
- クリックで選択/解除トグル
- マウスオーバーで座席情報表示（ツールチップ）
- 選択不可の座席は`disabled`状態

### Alpine.js による動作

```javascript
// 座席選択のリアクティブな動作
- 座席クリック → 選択中の座席エリアに追加
- [×]ボタンクリック → 座席選択を解除
- [クリア]ボタンクリック → すべての選択を解除
- 合計金額をリアルタイム計算
```

---

## 動作フロー

### 正常フロー

1. 購入者がイベント詳細ページから「座席を選択」ボタンをクリック
2. 座席選択画面が表示される
3. ビジュアル座席表から希望の座席をクリック
4. 選択中の座席エリアに追加される
5. 必要な座席をすべて選択したら「カートに追加」ボタンをクリック
6. Ajax通信でカートに追加（バックエンドで座席を仮予約）
7. 成功: カートページへリダイレクト
8. 失敗: エラーメッセージ表示

### エラーフロー

#### 1. 座席が既に売約済みの場合

```
エラー: 選択した座席は既に購入されました

以下の座席は選択できません:
・1階席-A-5

他の座席をお選びください。
```

#### 2. 選択座席数が上限を超えた場合

```
エラー: 座席は最大6席まで選択できます

現在の選択: 7席

選択を解除してから再度お試しください。
```

#### 3. 10分以内にカートに追加しなかった場合

```
警告: 座席の仮予約が期限切れになりました

選択座席が解除されました。
再度座席を選択してください。
```

---

## リアルタイム更新（WebSocketまたはポーリング）

### 他の購入者の選択状況を反映

- 5秒ごとにポーリング（プロトタイプでは簡易実装）
- 他の購入者が選択した座席は黄色に変更
- 他の購入者が購入完了した座席は赤色に変更

---

## レスポンシブ対応

### PC (1024px以上)
- 座席表はフルサイズで表示
- 座席ボタンは50x50px

### タブレット (768px - 1023px)
- 座席表は横スクロール可能
- 座席ボタンは40x40px

### スマホ (767px以下)
- 座席表は横スクロール可能
- 座席ボタンは30x30px
- ズーム機能追加（ピンチイン/アウト）

---

## Constitution遵守チェック

✅ **データモデル中心**: Seatモデルから座席ステータスを取得  
✅ **UI/UX実装前検証**: 画面モックで座席選択UIを明確化  
✅ **トランザクション制御**: カート追加時に`select_for_update()`で座席ロック  
✅ **タイムアウト処理**: 10分間の仮予約タイムアウト  
✅ **レスポンシブデザイン**: Bootstrap 5 + Alpine.jsで実装  
✅ **リアルタイム更新**: 他の購入者の選択状況を反映
