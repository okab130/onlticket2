# UI Mockup: QRコードスキャン画面

**画面名**: QRコードスキャン画面  
**ユーザー**: スタッフ（入場管理担当）  
**URL**: `/entry/scan/`  
**前提条件**: スタッフがログイン済み

---

## 画面レイアウト

```
┌──────────────────────────────────────────────────────────────┐
│ TicketPro 入場管理           [スタッフ: 田中] [ログアウト]    │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│ QRコードスキャン: 東京コンサート2026                          │
├──────────────────────────────────────────────────────────────┤
│ ゲート: [▼ Gate A]                   入場者数: 245 / 300     │
│                                                              │
│ ═══════════════════════════════════════════════════════════  │
│                                                              │
│ QRコードをスキャンしてください                                │
│ ┌────────────────────────────────────────────────────────┐  │
│ │                                                        │  │
│ │               ┌──────────────────┐                     │  │
│ │               │                  │                     │  │
│ │               │   カメラ映像     │                     │  │
│ │               │   (QRコード認識)  │                     │  │
│ │               │                  │                     │  │
│ │               └──────────────────┘                     │  │
│ │                                                        │  │
│ │           QRコードをカメラに向けてください               │  │
│ │                                                        │  │
│ └────────────────────────────────────────────────────────┘  │
│                                                              │
│ または手動入力                                                │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ チケット番号: [                          ]  [検証]      │  │
│ └────────────────────────────────────────────────────────┘  │
│                                                              │
│ ═══════════════════════════════════════════════════════════  │
│                                                              │
│ 最新のスキャン結果                                            │
│ ┌────────────────────────────────────────────────────────┐  │
│ │                                                        │  │
│ │  ✓ 入場許可 (19:45:30)                                  │  │
│ │  ┌──────────────────────────────────────────────────┐  │  │
│ │  │ チケット番号: ABCD1234EFGH5678                    │  │  │
│ │  │ 購入者: 山田 太郎                                  │  │  │
│ │  │ 座席: 1階席-A-5 (S席)                              │  │  │
│ │  └──────────────────────────────────────────────────┘  │  │
│ │                                                        │  │
│ └────────────────────────────────────────────────────────┘  │
│                                                              │
│ スキャン履歴                                                  │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ 時刻     │ 結果 │ チケット番号        │ 購入者    │ 座席  │  │
│ ├────────────────────────────────────────────────────────┤  │
│ │ 19:45:30 │ ✓   │ ABCD1234EFGH5678   │ 山田 太郎  │ A-5  │  │
│ │ 19:44:15 │ ✓   │ XYZA9876BCDE4321   │ 佐藤 花子  │ A-6  │  │
│ │ 19:43:00 │ ✗   │ FAKE1234567890AB   │ -         │ -    │  │
│ │ 19:42:30 │ ✗   │ MNOP5432QRST9876   │ 田中 一郎  │ B-10 │  │
│ │                                              (重複入場)   │  │
│ └────────────────────────────────────────────────────────┘  │
│                                                              │
│ [入場状況を見る]                                              │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## 画面要素

### ヘッダー

| 要素 | 説明 |
|-----|------|
| イベント名 | 現在スキャン中のイベント |
| ゲート選択 | Gate A, Gate B, Gate C から選択 |
| 入場者数 | 現在の入場者数 / 総枚数 |

### QRコードスキャン

- カメラ映像をリアルタイム表示
- QRコードを自動認識してスキャン
- スキャン成功時に音（ピッ）とバイブレーション

### 手動入力

- カメラが使えない場合の代替手段
- チケット番号（16桁）を手動入力
- [検証]ボタンでチケット検証

### スキャン結果表示

#### 入場許可（✓）

```
✓ 入場許可

チケット番号: ABCD1234EFGH5678
購入者: 山田 太郎
座席: 1階席-A-5 (S席)

[OK] ← タップして次のスキャンへ
```

#### 入場拒否（✗）- 重複入場

```
✗ 入場拒否

このチケットは既に使用されています

チケット番号: MNOP5432QRST9876
購入者: 田中 一郎
座席: 1階席-B-10 (S席)
入場日時: 2026年1月20日 19:30:15

[確認] ← タップして次のスキャンへ
```

#### 入場拒否（✗）- 無効なQRコード

```
✗ 入場拒否

無効なチケットです

改ざんされたQRコードまたは
チケットが存在しません

[確認] ← タップして次のスキャンへ
```

### スキャン履歴

| カラム | 説明 |
|-------|------|
| 時刻 | スキャン時刻 |
| 結果 | ✓（成功）/ ✗（失敗）|
| チケット番号 | チケット番号 |
| 購入者 | 購入者氏名 |
| 座席 | 座席番号 |

---

## 動作フロー

### 正常フロー（QRコードスキャン）

1. スタッフが入場管理画面にアクセス
2. カメラが起動し、QRコード認識開始
3. 購入者がチケットのQRコードをカメラに向ける
4. QRコードが認識される
5. バックエンドでチケット検証
   - QRコードの署名検証
   - チケットのステータス確認（有効/使用済み/キャンセル済み）
6. 検証成功 → 入場許可表示（✓）、入場記録保存、チケットステータスを「使用済み」に更新
7. 音（ピッ）とバイブレーションで成功通知
8. [OK]ボタンで次のスキャンへ

### エラーフロー（重複入場）

1. QRコードスキャン
2. チケットのステータスが「使用済み」
3. 入場拒否表示（✗）
4. エラー音とバイブレーションで拒否通知
5. 前回の入場日時を表示
6. [確認]ボタンで次のスキャンへ

### エラーフロー（無効なQRコード）

1. QRコードスキャン
2. 署名検証失敗またはチケットが存在しない
3. 入場拒否表示（✗）
4. エラー音とバイブレーションで拒否通知
5. [確認]ボタンで次のスキャンへ

---

## 入場状況画面

```
┌──────────────────────────────────────────────────────────────┐
│ 入場状況: 東京コンサート2026                                  │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│ サマリー                                                     │
│ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐         │
│ │ 総入場者数   │ │ Gate A       │ │ Gate B       │         │
│ │   245 / 300  │ │   150人      │ │    95人      │         │
│ └──────────────┘ └──────────────┘ └──────────────┘         │
│                                                              │
│ 時間帯別入場者数                                              │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ 19:00-19:15: ■■■■■■■■■■ 50人                        │  │
│ │ 19:15-19:30: ■■■■■■■■■■■■■■■■ 80人              │  │
│ │ 19:30-19:45: ■■■■■■■■■■■■■■■■■■■■ 100人      │  │
│ │ 19:45-20:00: ■■■■■ 15人                                │  │
│ └────────────────────────────────────────────────────────┘  │
│                                                              │
│ 入場者リスト（最新20件）                                      │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ 時刻     │ ゲート │ 購入者    │ 座席     │ スタッフ   │  │
│ ├────────────────────────────────────────────────────────┤  │
│ │ 19:45:30 │ Gate A │ 山田 太郎  │ 1階-A-5  │ 田中      │  │
│ │ 19:44:15 │ Gate A │ 佐藤 花子  │ 1階-A-6  │ 田中      │  │
│ │ 19:43:00 │ Gate B │ 鈴木 次郎  │ 2階-1-10 │ 山本      │  │
│ └────────────────────────────────────────────────────────┘  │
│                                                              │
│ [CSV出力]  [QRスキャンに戻る]                                 │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## レスポンシブ対応

### PC (1024px以上)
- カメラ映像を大きく表示
- スキャン履歴は横並び表示

### タブレット (768px - 1023px)
- カメラ映像は中サイズ
- スキャン履歴は縦並び表示

### スマホ (767px以下)
- カメラ映像はフルサイズ
- スキャン履歴はカード形式

---

## Constitution遵守チェック

✅ **データモデル中心**: Ticket, Entryモデルと連携  
✅ **QRコード検証**: 署名検証による改ざん防止  
✅ **重複入場チェック**: チケットステータスで使用済みを判定  
✅ **リアルタイム更新**: 入場者数をリアルタイム集計  
✅ **レスポンシブデザイン**: Bootstrap 5で実装  
✅ **オフラインモード対応**: 将来的にService Workerで実装可能
